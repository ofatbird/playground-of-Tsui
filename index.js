// @cookie
// cookie:__cfduid=d57c62f69d7cd6b8b383fcb7d62efcd321520754434; SID=n7cf13599vntjcmfrggpjsaq8m99jqgs; routing=%7B%22landing%22%3Afalse%2C%22adv_id%22%3A1000%7D; s_info=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; psale=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; ssale=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; site_197=1; origin=promo; timestamp=1520754434; _gat_UA-25669471-2=1; _gat_UA-25669471-1=1; _gat_UA-19649057-1=1; enterSite=en; abt_detect=true; _ga=GA1.2.4753132.1520754435; _gid=GA1.2.2054424962.1520754435; sg_cookies={%225618512%22:{%22vid%22:%2250c90380-959a-4e83-952e-23e0f3cea3f9%22%2C%22lw%22:%223-11-15-47%22%2C%22rf%22:%22https://www.baidu.com/link?url=4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53&wd=&eqid=f49a60ae00002d1b000000055aa4deac%22%2C%22pw%22:3%2C%22tc%22:3%2C%22tv%22:1%2C%22fp%22:460925964%2C%22ts%22:50%2C%22tmp%22:50%2C%22si%22:%224e5ea8c2-1f0c-45d3-9834-9ae466f4b322%22}} 

const puppeteer = require('puppeteer')
const jsonfile = require('jsonfile')
const fs = require('fs')
const to = require('await-to-js').to

const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms))

puppeteer.launch().then(async browser => {
    let count = 1
    let indexDB = []
    while (true) {
        if (count > 7) break
        console.log(`Start parsing ${count}`)
        const page = await browser.newPage()
        const prefixUrl = `https://www.girlfriendsfilms.com/en/dvds/0/Category/Actor/0/0/`
        await page.setExtraHTTPHeaders({
            cookie: `__cfduid=d57c62f69d7cd6b8b383fcb7d62efcd321520754434; SID=n7cf13599vntjcmfrggpjsaq8m99jqgs; routing=%7B%22landing%22%3Afalse%2C%22adv_id%22%3A1000%7D; s_info=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; psale=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; ssale=a%253A15%253A%257Bs%253A6%253A%2522adv_id%2522%253Bi%253A1000%253Bs%253A8%253A%2522campaign%2522%253Bs%253A0%253A%2522%2522%253Bs%253A12%253A%2522country_code%2522%253Bs%253A2%253A%2522CN%2522%253Bs%253A6%253A%2522origin%2522%253Bs%253A5%253A%2522promo%2522%253Bs%253A10%253A%2522program_id%2522%253Bi%253A8%253Bs%253A11%253A%2522referer_url%2522%253Bs%253A137%253A%2522https%253A%252F%252Fwww.baidu.com%252Flink%253Furl%253D4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53%2526wd%253D%2526eqid%253Df49a60ae00002d1b000000055aa4deac%2522%253Bs%253A13%253A%2522subprogram_id%2522%253Bi%253A1%253Bs%253A7%253A%2522site_id%2522%253Bi%253A197%253Bs%253A10%253A%2522gallery_id%2522%253Bi%253A0%253Bs%253A10%253A%2522user_agent%2522%253Bs%253A125%253A%2522Mozilla%252F5.0%2520%2528Windows%2520NT%25206.1%253B%2520WOW64%2529%2520AppleWebKit%252F537.36%2520%2528KHTML%252C%2520like%2520Gecko%2529%2520Chrome%252F54.0.2840.59%2520Safari%252F537.36%2520115Browser%252F8.6.1%2522%253Bs%253A7%253A%2522section%2522%253Bs%253A8%253A%2522freetour%2522%253Bs%253A4%253A%2522type%2522%253BN%253Bs%253A7%253A%2522skin_id%2522%253Bi%253A0%253Bs%253A5%253A%2522pg_id%2522%253Bs%253A88%253A%2522zXiX4xnC5empiUK5iXAyBd45JsVFhPL5gn5xtPspMybGziN5kW1qJlHSxk7fBdQOi7Y6zrD8Byfeu1y%252Fy85dUg%253D%253D%2522%253Bs%253A9%253A%2522timestamp%2522%253Bi%253A1520754434%253B%257D; site_197=1; origin=promo; timestamp=1520754434; _gat_UA-25669471-2=1; _gat_UA-25669471-1=1; _gat_UA-19649057-1=1; enterSite=en; abt_detect=true; _ga=GA1.2.4753132.1520754435; _gid=GA1.2.2054424962.1520754435; sg_cookies={%225618512%22:{%22vid%22:%2250c90380-959a-4e83-952e-23e0f3cea3f9%22%2C%22lw%22:%223-11-15-47%22%2C%22rf%22:%22https://www.baidu.com/link?url=4pUvdTtcPMUMXFpuGusnbpdaIn1RSgPdjg6ge_4klHe7w7n5gdvsAGQzTesrhm53&wd=&eqid=f49a60ae00002d1b000000055aa4deac%22%2C%22pw%22:3%2C%22tc%22:3%2C%22tv%22:1%2C%22fp%22:460925964%2C%22ts%22:50%2C%22tmp%22:50%2C%22si%22:%224e5ea8c2-1f0c-45d3-9834-9ae466f4b322%22}}`
        })

        const [netErr] = await to(page.goto(prefixUrl + '1', {
            waitUntil: 'networkidle2'
        }))

        if (netErr) {
            await page.close()
            console.log(`networkErr`)
            continue
        }

        const resource = await page.evaluate(() => {
            const wrappers = document.querySelectorAll('.tlcItem')
            return [].map.call(wrappers, ele => {
                return {
                    name: ele.querySelector('.tlcTitle>a').innerText,
                    cover: ele.querySelector('img').getAttribute('data-original'),
                    data: ele.querySelector('.tlcSpecsDate .tlcDetailsValue').innerText
                }
            })
        })
        // fs.writeFileSync('./index.html', await page.content())
        count++
        await page.close()
        indexDB = indexDB.concat(resource)
        console.log('sleep for 5 seconds')
        await sleep(5000)
    }
    await browser.close()
    let bson = {}
    indexDB.forEach((ele, index) => {
        bson[index] = ele
    })
    await browser.close()
    jsonfile.writeFileSync('./gf.json', bson)
})